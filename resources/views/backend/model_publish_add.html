<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>{{.category.Catname}} 内容发布</title>
    {{template "backend/public_javascript.html"}}
    {{template "backend/public_umeditor.html"}}
    <script src="/assets/backend/static/jquery.upload.js"></script>
    <style>
        .dialogtable {
            width: 100%;
        }

        .dialogtable td {
            border-width: 0 1px 1px 0;
            border-style: dotted;
            border-color: #ccc;
            /*margin: 0;*/
            padding: 15px 7px;
        }

        #tags_tagsinput {
            margin-left: 8px;
        }

        input {
            max-width: 450px;
            padding: 3px;
            margin: 8px;
            height: 25px;
        }

        .imgbox {
            display: inline-block;
            margin-right: 10px;
            position: relative;
        }

        .imgbox_inputBtn {
            width: 95px;
            height: 95px;
            display: block;
            border: 1px solid #ddd;
            padding: 2px
        }

        table.mdoutable {
            width: 100%;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }

        table.mdoutable th {
            border-width: 1px;
            padding: 8px;
            border-style: dotted;
            border-color: rgb(204, 204, 204);
            background-color: #dedede;
        }

        .textbox .textbox-text, .textbox {
            -moz-border-radius: 0;
            -webkit-border-radius: 0;
            border-radius: 0;
        }

        table.mdoutable td {
            border-width: 1px;
            padding: 8px;
            border-style: dotted;
            border-color: rgb(204, 204, 204);
            background-color: #ffffff;
        }

    </style>
</head>
<body>
<div>
    {{.form}}
</div>
<script type="text/javascript">
    // $.validator.setDefaults({
    //     submitHandler: function () {
    //         contentPageFormSubmit()
    //     }
    // });
    function contentPageFormSubmit() {
        $.post('/b/content/add?catid={{.category.Catid}}', $("#content_page_form").serialize(), function (res) {
            if (res.errcode) {
                parent.$.messager.alert('提示信息', res.errmsg, 'error');
            } else {
                parent.$.messager.alert('提示信息', res.errmsg, 'info');
                parent.contentMainOpenUrl("/b/content/news-list?catid={{.category.Catid}}")
            }
        });
        return false;
    }


    function doUpload(obj) {
        $.upload({
            url: "/public/upload",
            fileName: 'formfile',
            params: {},
            dataType: 'json',
            onSend: function () {
                return true;
            },
            onComplate: function (data) {
                if (data.errcode == 1) {
                    parent.$.messager.alert("错误提醒", data.errmsg, "error")
                } else {
                    $(obj).next().val(data.msg);
                    $(obj).attr('src', data.msg);
                }
            }
        });
        return false;
    }

    function createHtml(obj, maxNumInt) {
        if (maxNumInt > 0 && $(obj).parent().find(".imgbox").size() >= maxNumInt + 1) {
            parent.$.messager.alert("提醒", "图片限制数量已达上限" + maxNumInt + ",无法添加", "info");
            return false;
        }
        var str = "<div class='imgbox'>\
                  <input class='imgbox_inputBtn' type='image' onclick='return doUpload(this)' src='/assets/backend/mdou/images/uploadholder.png' alt='点击上传'/>\
                  <input type='hidden' name='info[thumb][]' />\
                  <span title=\"删除图片框\" style='color:#fff;display:inline-block;width:15px;height:15px;font-size:15px;line-height:15px;text-align:center;background:rgba(0,0,0,0.5);font-weight:normal;cursor:pointer;    position: absolute;left: 92px;top: 10px;'  onclick=''>×</span>\
        </div>";
        $(obj).before(str);
        return false;
    }


    function DelImg(obj) {
        layer.confirm('要删除此图片吗？', {
            btn: ['确定','取消']
        }, function(){
            $(obj).prev().val("");
            $(obj).prev().prev().attr('src',"/assets/backend/mdou/images/uploadholder.png");
            layer.closeAll();
        }, function(){});
    }


    function submitForm(){
        $('#content_page_form').form('submit');
    }
    function clearForm(){
        $('#content_page_form').form('clear');
    }

</script>


</body>
</html>