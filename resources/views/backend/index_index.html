<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>内容管理系统</title>
    {{template "backend/public_javascript.html"}}
    {{template "backend/public_umeditor.html"}}
    <style>
        .panel-header {
            background: url("/assets/backend/mdou/images/left_nav_divbg.png") no-repeat scroll 15px -3px #f0f0f0;
            color: #000000;
            font: 12px/31px 宋体;
            text-align: left;
            text-indent: 20px;
        }

        .panel-icon, .panel-tool {
            overflow: hidden;
            position: absolute;
            top: 50%;
        }

        .icons-other-house {
            display: none;
        }

        .tabs-title, .datagrid-header .datagrid-cell span, .datagrid-cell, .panel-title, .tree-title {
            font-weight: normal;
            font-size: 12px;
        }

        .accordion .accordion-header {
            background: url("/assets/backend/mdou/images/left_nav_divbg.png") no-repeat scroll 15px -3px #f0f0f0;
            color: #000000;
            font: 12px/31px 宋体;
            text-align: left;
            text-indent: 20px;
        }

        .accordion .accordion-header-selected {
            background: url("/assets/backend/mdou/images/left_nav_divbg.png") no-repeat scroll 15px -27px rgb(73, 137, 205);
            color: #fff;
            text-decoration: none;
            text-indent: 20px;
        }

        .accordion .accordion-header {
            filter: none;
        }

        .icons-folder-folder_go {
            display: none;
        }
        .tree-node-selected {
            background-color: rgb(90, 116, 131);
        }

        table.mdoutable {
            width: 100%;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }

        table.mdoutable th {
            border-width: 1px;
            padding: 15px;
            border-style: dotted;
            border-color: rgb(204, 204, 204);
            background-color: #dedede;
        }

        table.mdoutable td {
            border-width: 1px;
            padding: 8px;
            border-style: dotted;
            border-color: rgb(204, 204, 204);
            background-color: #ffffff;
        }

        table.mdoutable td input[type='text'], table.mdoutable td select, table.mdoutable td .easyui-combotree {
            width: 280px;
        }

        .tabs li.tabs-selected a.tabs-inner {
            font-weight: normal;
        }

        .tabs-header-bottom .tabs li a.tabs-inner {
            border-radius: 0px;
        }

        .tabs li.tabs-selected a.tabs-inner {
            /*color: rgb(217,0,0);*/
        }


        .dialogtable {
            width: 100%;
        }

        .dialogtable td {
            border-width: 0 1px 1px 0;
            border-style: dotted;
            border-color: #ccc;
            /*margin: 0;*/
            padding: 15px;
        }

        .panel .panel-header {
            background-image: none;
        }

        .tree-node {
            height: 20px;
            /* line-height: 30px; */
            /* vertical-align: middle; */
            padding: 5px 0;
        }
    </style>

</head>
<body class="easyui-layout" >
<!-- 左侧菜单 -->
<div id="leftarea" data-options="iconCls:'icons-other-house',region:'west', split:true,width:230" >
    <div style="padding: 10px;text-align: center"><img src="/assets/pinecms.png" style="width: 100px;"/></div>
    <div id="leftmenu" class="easyui-accordion" style="background: #fff;" data-options="fit:true,border:false"></div>
</div>

<!-- 内容 -->
<div id="mainarea" data-options="region:'center'">
    <div id="pagetabs" class="easyui-tabs" data-options="tabPosition:'top',fit:true,border:false,plain:false">
        <div title="后台首页" href="main" data-options="cache:false,title:'后台首页'"></div>
    </div>
</div>


<script type="text/javascript">
    $(function () {
        getLeft(1, '后台首页');
    });
    function fromUEImageUploader(that, mode) {
        event.preventDefault();
        var myEditorImage = UE.getEditor('myEditorImage', {autoHeightEnabled: false, isShow: false});
        if (!mode) {
            mode = 0
        } else {
            mode = 1
        }
        currentUploaderMode = mode;
        myEditorImage.ready(function () {
            myEditorImage.addListener('beforeInsertImage', function (t, arg) {
                $(that).attr("src", arg[0].src)
                $(that).next().val(arg[0].src)
                parnt.currentUploaderMode = !mode;
            });
            setTimeout(function () {
                var d = myEditorImage.getDialog("insertimage");
                d.render();
                d.open();
            }, 200)
        });
        return false
    }


    //退出登录
    function logout() {
        $.messager.confirm('提示信息', '确定要退出登录吗？', function (result) {
            if (result) window.location.href = '/b/login/logout';
        });
    }

    //显示左侧栏目
    function getLeft(menuid, title, that) {
        //加个判断，防止多次点击重复加载
        // var options = $('body').layout('panel', 'west').panel('options');
        // if (title == options.title) return false;
        //开始获取左侧栏目


        $.ajax({
            type: 'POST',
            url: '/b/index/menu',
            data: {menuid: menuid},
            cache: true,
            // beforeSend: function () {
            //     // removeLeft();
            //     //更新标题名称
            //     // $('body').layout('panel', 'west').panel({title: title});
            //     // var loading = '<div class="panel-loading">加载中...</div>';
            //     // $("#leftmenu").accordion("add", {content: loading});
            //
            // },
            success: function (data) {
                // removeLeft();
                //左侧内容更新
                $.each(data, function (i, menu) {
                    var content = '';
                    if (menu.son) {
                        var treedata = $.toJSON(menu.son);
                        content = '<ul class="easyui-tree" data-options=\'data:' + treedata + ',onClick:function(node){openUrl(node.url, node.text)}\'></ul>';
                    }
                    $("#leftmenu").accordion("add", {
                        title: menu.name,
                        content: content,
                        iconCls: 'icons-folder-folder_go'
                    });
                });
            }
        });
        //默认选中头部菜单
        if (that) {
            $('#topmenu .nav li').each(function () {
                $(this).children().removeClass('focus');
            })
            $(that).addClass('focus');
        }
    }

    //移除左侧菜单
    function removeLeft(stop) {
        var pp = $("#leftmenu").accordion("panels");
        $.each(pp, function (i, n) {
            if (n) {
                var t = n.panel("options").title;
                $("#leftmenu").accordion("remove", t);
            }
        });
        var pp = $('#leftmenu').accordion('getSelected');
        if (pp) {
            var t = pp.panel('options').title;
            $('#leftmenu').accordion('remove', t);
        }
        if (!stop) removeLeft(true)//发现执行两次才能彻底移除
    }

    //显示打开内容
    function openUrl(url, title, iframe) {
        if ($('#pagetabs').tabs('exists', title)) {
            $('#pagetabs').tabs('select', title);
        } else {
            var option = {
                title: title,
                href: url,
                closable: true,
                cache: false
            }
            if (iframe) {
                option.href = null
                option.content = '<iframe src="' + url + '" frameborder="0" fit="true" border="none" width="100%" height="100%"></iframe>'
            }
            if (title === "实时日志") {
                option.cache = true
            }
            $('#pagetabs').tabs('add', option);
        }
    }

    //防止登录超时
    setInterval(function () {
        $.get('/b/index/sessionlife');
    }, 200000);

    function ajaxLoading() {
        $("<div class=\"datagrid-mask\"></div>").css({
            display: "block",
            width: "100%",
            height: $(window).height()
        }).appendTo("body");
        $("<div class=\"datagrid-mask-msg\"></div>").html("正在处理，请稍候。。。").appendTo("body").css({
            display: "block",
            left: ($(document.body).outerWidth(true) - 190) / 2,
            top: ($(window).height() - 45) / 2
        });
    }

    function ajaxLoadEnd() {
        $(".datagrid-mask").remove();
        $(".datagrid-mask-msg").remove();
    }

</script>
<div id="myEditorImage" style="display: none"></div>
</body>
</html>
